package y2020

object Day9 extends App {

  val inTest = List(
    35L,
    20L,
    15L,
    25L,
    47L,
    40L,
    62L,
    55L,
    65L,
    95L,
    102L,
    117L,
    150L,
    182L,
    127L,
    219L,
    299L,
    277L,
    309L,
    576L
  )

  val in = List(
    37L,
    1L,
    33L,
    42L,
    17L,
    34L,
    27L,
    44L,
    26L,
    39L,
    3L,
    43L,
    30L,
    22L,
    9L,
    38L,
    7L,
    28L,
    21L,
    4L,
    50L,
    14L,
    35L,
    12L,
    5L,
    6L,
    71L,
    8L,
    15L,
    10L,
    11L,
    13L,
    16L,
    53L,
    17L,
    20L,
    18L,
    19L,
    23L,
    24L,
    9L,
    22L,
    25L,
    26L,
    21L,
    27L,
    28L,
    14L,
    67L,
    29L,
    30L,
    31L,
    33L,
    59L,
    32L,
    34L,
    35L,
    37L,
    40L,
    42L,
    54L,
    41L,
    39L,
    36L,
    23L,
    51L,
    61L,
    58L,
    43L,
    44L,
    102L,
    47L,
    46L,
    52L,
    53L,
    78L,
    55L,
    56L,
    65L,
    57L,
    101L,
    66L,
    114L,
    59L,
    80L,
    64L,
    62L,
    67L,
    69L,
    79L,
    87L,
    135L,
    133L,
    89L,
    90L,
    122L,
    108L,
    223L,
    113L,
    126L,
    115L,
    124L,
    116L,
    119L,
    151L,
    125L,
    121L,
    123L,
    128L,
    191L,
    129L,
    197L,
    348L,
    156L,
    234L,
    244L,
    179L,
    202L,
    198L,
    246L,
    224L,
    221L,
    228L,
    240L,
    231L,
    478L,
    235L,
    331L,
    242L,
    248L,
    285L,
    249L,
    251L,
    257L,
    308L,
    377L,
    463L,
    354L,
    335L,
    582L,
    381L,
    400L,
    419L,
    433L,
    445L,
    449L,
    456L,
    483L,
    477L,
    473L,
    559L,
    484L,
    490L,
    491L,
    536L,
    724L,
    611L,
    508L,
    565L,
    662L,
    831L,
    689L,
    716L,
    818L,
    864L,
    845L,
    819L,
    852L,
    878L,
    894L,
    905L,
    1301L,
    950L,
    957L,
    963L,
    1197L,
    974L,
    1170L,
    1417L,
    1762L,
    2607L,
    1073L,
    1224L,
    1227L,
    1757L,
    1520L,
    1405L,
    1580L,
    1924L,
    1742L,
    2367L,
    3262L,
    1967L,
    3100L,
    1799L,
    1862L,
    1907L,
    1931L,
    4109L,
    1937L,
    2198L,
    2201L,
    2243L,
    2478L,
    2297L,
    3148L,
    2997L,
    5515L,
    2985L,
    3204L,
    3319L,
    5186L,
    3322L,
    3736L,
    3706L,
    3661L,
    5282L,
    3730L,
    4340L,
    4679L,
    5517L,
    5240L,
    3868L,
    4135L,
    7716L,
    6378L,
    4444L,
    7812L,
    7454L,
    6352L,
    5982L,
    7072L,
    13054L,
    6853L,
    6940L,
    7442L,
    7436L,
    6983L,
    10808L,
    7367L,
    8970L,
    7865L,
    11427L,
    16042L,
    10661L,
    14307L,
    10117L,
    11584L,
    23862L,
    12309L,
    10426L,
    10796L,
    12334L,
    12835L,
    15910L,
    12922L,
    14848L,
    13793L,
    13836L,
    14376L,
    14350L,
    26336L,
    22713L,
    15232L,
    16337L,
    16835L,
    38670L,
    26170L,
    20543L,
    20778L,
    20913L,
    64840L,
    25420L,
    29198L,
    22735L,
    26028L,
    23130L,
    41402L,
    25757L,
    26715L,
    26758L,
    27629L,
    28169L,
    28186L,
    28726L,
    29582L,
    31569L,
    32067L,
    42255L,
    33172L,
    49845L,
    50125L,
    41321L,
    41691L,
    43648L,
    93773L,
    45865L,
    48763L,
    48492L,
    49450L,
    75207L,
    89513L,
    52515L,
    54387L,
    76165L,
    54927L,
    57751L,
    56355L,
    56912L,
    58308L,
    61151L,
    63636L,
    65239L,
    87186L,
    74493L,
    109914L,
    115220L,
    95708L,
    85339L,
    110742L,
    110601L,
    109314L,
    97255L,
    97942L,
    101965L,
    106902L,
    108870L,
    107442L,
    207169L,
    205622L,
    111282L,
    113267L,
    114663L,
    150822L,
    213247L,
    124787L,
    197673L,
    139732L,
    182594L,
    364069L,
    181047L,
    183281L,
    301330L,
    187304L,
    195197L,
    402366L,
    204844L,
    199220L,
    199907L,
    208867L,
    214344L,
    296174L,
    218724L,
    224549L,
    239450L,
    225945L,
    319507L,
    254395L,
    334103L,
    264519L,
    327036L,
    365677L,
    364328L,
    395104L,
    564235L,
    448317L,
    370585L,
    382501L,
    386524L,
    590273L,
    423568L,
    946736L,
    414251L,
    408774L,
    423211L,
    589309L,
    489068L,
    443273L,
    544056L,
    465395L,
    480340L,
    518914L,
    661139L,
    651043L,
    591555L,
    778579L,
    730005L,
    734913L,
    753086L,
    757109L,
    847896L,
    1021628L,
    1538291L,
    1149164L,
    889114L,
    831985L,
    1342395L,
    1219073L,
    852047L,
    954463L,
    987329L,
    1941792L,
    908668L,
    945735L,
    984309L,
    999254L,
    1892977L,
    1242598L,
    1326468L,
    3834769L,
    1492022L,
    2194442L,
    1487999L,
    1910742L,
    1589094L,
    1679881L,
    1684032L,
    1721099L,
    1740653L,
    2476331L,
    2536079L,
    1797782L,
    1806510L,
    2762789L,
    1907922L,
    1854403L,
    1930044L,
    2325722L,
    1983563L,
    2226907L,
    2982817L,
    2569066L,
    3150520L,
    2814467L,
    3167880L,
    3477663L,
    3077093L,
    3285781L,
    3363913L,
    3424685L,
    3400980L,
    3405131L,
    3461752L,
    3538435L,
    3604292L,
    3837966L,
    3652185L,
    3714432L,
    4081310L,
    3762325L,
    3784447L,
    5407707L,
    5632038L,
    4552629L,
    4795973L,
    5383533L,
    5646159L,
    5891560L,
    5982347L,
    6244973L,
    6915059L,
    8267061L,
    7148360L,
    7318724L,
    6806111L,
    6862732L,
    6866883L,
    7142727L,
    7190620L,
    7366617L,
    7414510L,
    7436632L,
    10647179L,
    7546772L,
    10428011L,
    8337076L,
    12836779L,
    9348602L,
    13107705L,
    12531893L,
    11275093L,
    12754292L,
    11873907L,
    20474322L,
    14242743L,
    13668843L,
    18423453L,
    13729615L,
    13672994L,
    13948838L,
    14009610L,
    14057503L,
    14851142L,
    14557237L,
    18013796L,
    14961282L,
    14983404L,
    18821865L,
    15883848L,
    17685678L,
    19612169L,
    28519985L,
    20623695L,
    23149000L,
    23806986L,
    25284703L,
    25822745L,
    28286852L,
    27341837L,
    27398458L,
    27402609L,
    29040907L,
    27621832L,
    27682604L,
    28006341L,
    28067113L,
    28614740L,
    29408379L,
    29518519L,
    45972530L,
    29944686L,
    30867252L,
    38309373L,
    43566452L,
    37297847L,
    40235864L,
    43772695L,
    44430681L,
    46955986L,
    49091689L,
    52687312L,
    54109597L,
    54740295L,
    54801067L,
    65912587L,
    65304188L,
    57140351L,
    75607220L,
    56297344L,
    56073454L,
    96779839L,
    58023119L,
    50047984L,
    74639947L,
    60811938L,
    67242533L,
    69176625L,
    107488379L,
    77533711L,
    81728528L,
    84008559L,
    88203376L,
    91386667L,
    99139673L,
    104788279L,
    108071103L,
    109541362L,
    131780298L,
    104849051L,
    112370798L,
    121377642L,
    106121438L,
    117109282L,
    106345328L,
    173182736L,
    125265652L,
    110859922L,
    149187657L,
    128054471L,
    160563292L,
    151251092L,
    146710336L,
    169931904L,
    159262239L,
    165737087L,
    188857610L,
    203988724L,
    190526340L,
    208681035L,
    209637330L,
    210970489L,
    214390413L,
    285553534L,
    215708973L,
    362040346L,
    212466766L,
    216981360L,
    217205250L,
    231610980L,
    387573149L,
    236125574L,
    351089632L,
    274764807L,
    279305563L,
    297961428L,
    305972575L,
    471709662L,
    324999326L,
    348119849L,
    354594697L,
    379383950L,
    407507700L,
    595092923L,
    499943947L,
    579021706L,
    510428194L,
    426857179L,
    428175739L,
    429448126L,
    444077746L,
    429672016L,
    434186610L,
    665797590L,
    946182555L,
    732148038L,
    510890381L,
    879327897L,
    769671090L,
    604304889L,
    1390260301L,
    630971901L,
    679594023L,
    673119175L,
    788781307L,
    733978647L,
    807559689L,
    856529195L,
    938603933L,
    855032918L,
    954505940L,
    939876320L,
    857847755L,
    857623865L,
    863858626L,
    873749762L,
    1523645345L,
    1400642991L,
    1893109873L,
    1115195270L,
    1465396321L,
    1461928754L,
    1634099963L,
    1235276790L,
    1277424064L,
    1304091076L,
    1310565924L,
    1714153060L,
    1664088884L,
    1522759954L,
    1718891544L,
    2381493100L,
    3024718984L,
    2161938831L,
    1712656783L,
    1715471620L,
    1737608388L,
    4259995774L,
    1721482491L,
    1979053896L,
    1988945032L,
    2350472060L,
    3064731875L,
    2512700854L,
    4329525956L,
    2927325075L,
    4176789738L,
    3428128403L,
    4095646160L,
    4375297799L,
    2614657000L,
    2833325878L,
    3186848838L,
    4231592398L,
    3260368342L,
    4981850833L,
    5346026732L,
    4822270910L,
    4336139491L,
    4642796695L,
    4902320458L,
    3459090879L,
    3700536387L,
    7064918276L,
    3967998928L,
    5773069196L,
    5183797938L,
    5127357854L,
    5440025929L,
    8409979236L,
    6846249398L,
    8361411337L,
    6093694220L,
    6073747879L,
    5447982878L,
    7154847766L,
    6020174716L,
    6447217180L,
    6719459221L,
    6960904729L,
    7668535315L,
    13034652608L,
    7159627266L,
    7427089807L,
    8101887574L,
    8642888817L,
    8586448733L,
    9415981806L,
    9095356782L,
    12619318594L,
    13801437266L,
    12400930658L,
    10567383783L,
    10888008807L,
    14115752495L,
    11468157594L,
    13520784027L,
    11521730757L,
    12602830644L,
    11895200058L,
    12467391896L,
    12739633937L,
    21043819475L,
    13680363950L,
    14586717073L,
    15095625122L,
    15261514840L,
    15528977381L,
    16013538540L,
    25828898623L,
    26108447830L,
    17681805515L,
    18511338588L,
    19983365589L,
    21455392590L,
    37665171104L,
    22035541377L,
    22089114540L,
    22356166401L,
    28616369184L,
    22989888351L,
    31878565647L,
    23416930815L,
    24362591954L,
    27326351010L,
    25207025833L,
    26419997887L,
    28941878790L,
    43718364421L,
    29682342195L,
    39458217076L,
    36193144103L,
    37618091921L,
    33695344055L,
    54868453998L,
    59073484511L,
    39966731178L,
    62875147891L,
    41438758179L,
    43490933967L,
    44124655917L,
    44391707778L,
    45079002891L,
    45346054752L,
    66784568086L,
    67541586732L,
    71121100374L,
    47779522769L,
    49569617787L,
    51627023720L,
    54148904623L,
    83972666872L,
    63377686250L,
    96706026611L,
    67300434116L,
    69888488158L,
    108643102298L,
    106366081858L,
    155779511122L,
    115245756291L,
    95751679637L,
    81405489357L,
    93065781899L,
    84929692146L,
    87615589884L,
    159370412208L,
    134499309933L,
    99494959375L,
    137188922274L,
    97349140556L,
    149064577162L,
    99406546489L,
    101928427392L,
    103718522410L,
    105775928343L,
    144783175607L,
    167237628714L,
    130678120366L,
    152230126262L,
    233994269308L,
    323017139836L,
    166335181503L,
    178754629913L,
    187110549259L,
    169021079241L,
    262989308351L,
    172545282030L,
    253950771387L,
    421188400101L,
    196844099931L,
    205270887718L,
    265830140878L,
    359655831289L,
    460206062110L,
    244189722096L,
    250993004554L,
    313804254848L,
    357669293797L,
    396508261244L,
    528288027554L,
    458587430455L,
    336258707955L,
    341566361271L,
    318565307765L,
    335356260744L,
    777152738220L,
    338880463533L,
    347775709154L,
    356131628500L,
    365865179172L,
    369389381961L,
    590209479342L,
    402114987649L,
    516823145432L,
    441033822027L,
    449460609814L,
    583070185629L,
    661579964002L,
    562755029861L,
    579545982840L,
    564797259402L,
    894153206726L,
    674236724277L,
    653921568509L,
    660131669036L,
    654824015720L,
    657445771298L,
    666341016919L,
    674696936265L,
    683131969898L,
    890494431841L,
    910530739015L,
    703907337654L,
    721996807672L,
    1564731156118L,
    1026835153259L,
    851575597463L,
    843148809676L,
    1327920980921L,
    1003788851888L,
    1109592278850L,
    1127552289263L,
    1144343242242L,
    1819040178507L,
    1218718827911L,
    1219621275122L,
    1357828906163L,
    1308745584229L,
    1311367339807L,
    1312269787018L,
    1340577741196L,
    1323786788217L,
    1341037953184L,
    1686920821786L,
    1987492051918L,
    1952741088526L,
    1694724407139L,
    2061736243817L,
    1565145617348L,
    1846937661564L,
    2030624005147L,
    1855364449351L,
    3097084330768L,
    2640190767939L,
    2113381130738L,
    2237144568113L,
    3035762360323L,
    2438340103033L,
    2543408063339L,
    2530988614929L,
    2528366859351L,
    2623637126825L,
    2905723358544L,
    2635154128024L,
    3981228721123L,
    4737018257563L,
    2664824741401L,
    3293779041710L,
    3877561666711L,
    3259870024487L,
    3412083278912L,
    3541662068703L,
    3420510066699L,
    3595769622495L,
    3702302110915L,
    3885988454498L,
    8718246978686L,
    5288461868226L,
    4675484671146L,
    4350525698851L,
    4765511427464L,
    4966706962384L,
    5163520987375L,
    8271254293641L,
    5152003986176L,
    7306498521197L,
    6367126852316L,
    5299978869425L,
    7145858478985L,
    8614579924274L,
    7610395723338L,
    6996081152625L,
    6671953303399L,
    6680380091186L,
    8052827809766L,
    7243964179618L,
    11042611523462L,
    10717652551167L,
    7298071733410L,
    7588290565413L,
    8236514153349L,
    14302579673822L,
    9116037126315L,
    13380091351738L,
    9317232661235L,
    11132638279780L,
    12407485166993L,
    10315524973551L,
    10451982855601L,
    11519130838492L,
    11667105721741L,
    17352551279664L,
    23832074207339L,
    13352333394585L,
    13668034456024L,
    13676461243811L,
    13915917483017L,
    19833689677482L,
    14268670656599L,
    20248675406095L,
    17961616730785L,
    25969685395563L,
    14886362298823L,
    15824804718762L,
    16704327691728L,
    20635167964807L,
    18433269787550L,
    19431562099866L,
    19769215516836L,
    19632757634786L,
    26323402650010L,
    23926616005485L,
    23804316250186L,
    30950692938358L,
    23186236560233L,
    32985091029371L,
    34102360334081L,
    40267925599593L,
    27583951939041L,
    32109731031361L,
    27592378726828L,
    28184588139616L,
    37339495656535L,
    30711167017585L,
    31590689990551L,
    32529132410490L,
    33319632086373L,
    34258074506312L,
    59135281077974L,
    43559373640271L,
    51585860903165L,
    37864831887416L,
    42818994195019L,
    39401973151622L,
    47817345774402L,
    50778615287061L,
    69455521877967L,
    46990552810419L,
    54136929498591L,
    75348126605509L,
    55176330665869L,
    55768540078657L,
    91046540886654L,
    55776966866444L,
    82075420280714L,
    58303545744413L,
    85682177661818L,
    70393964297906L,
    85887497683454L,
    64119822401041L,
    71184463973789L
  )


  def findWeakness(in: List[Long], preambleSize:Int): Long = {
    in.sliding(preambleSize + 1).find { group =>
      val wanted = group.last

      !group.combinations(2).exists { x =>
        x.head + x.last == wanted
      }
    }.get.last
  }

  def break(in: List[Long], weakness:Long) : Long = {
    val init = List[Long]()

    // drop all redundant candidates
    // if they're bigger than the weakness, they cant be part of the range
    // it's important that we go backward, so we can drop the the oldest, highest number if the sum exceeds the weakness
    val numbers = in.filter(_ < weakness).foldRight((init,false)) { case( nextNumber, (numbers,found)) =>
      val currentSum = numbers.sum

      if(found || currentSum == weakness) { // we found it
        (numbers, true)
      } else {
        // some options
        val newSum = currentSum + nextNumber
        if(newSum > weakness) {
          // too high, drop the oldest numbers untill we fall below the weakness again
          (nextNumber :: numbers.dropRight(1), false)
        } else {
          // just add the number to the list
          (nextNumber :: numbers, false)
        }
      }
    }

    numbers._1.min + numbers._1.max
  }


  val part1 = findWeakness(in, 25)
  println(part1)

  val part2 = break(in, part1)
  println(part2)
}
